# D0 Trial-2 Pre-registration — V0.6.3 temporal-only falsification battery v0 — 2026-01-07

Fill this template **before running**. Do not edit after execution (append-only is allowed).

---

## 0) Trial identity

- trial_id: `d0_trial_2_v0_6_3_temporal_only_falsification_battery`
- owner: (TBD)
- date_utc: `2026-01-06T20:06:26.977595Z` (Step 0 execution)
- repo_commit_quant: `3eab4bb7709ea62ce9f5f73294c2e07b1b16b9a4` (Prometheus-Quant)
- repo_commit_research: `5dacaa37b1269430a829c150da6747b6423db624` (Prometheus-Research)

---

## 1) World input (frozen for this trial)

- dataset_dir: (TBD; generated by tick loop replay; see §1.0 Dataset generation protocol)
- dataset_id: `SWAP_universe_A_2018-01-01__2019-12-31` (registered before dataset exists)
- inst_id: `BTC-USDT-SWAP` (OKX instId; universe_A is an alias)
- inst_id_alias: `universe_A`
- tick_interval_ms: `60000` (amended via §1.0.1 A1; original: 1000) (frozen; matches Trial-1; avoid time resolution as a free knob)
- segment/window description:
  - Time window is **strictly non-overlapping** with Trial-1.
  - Boundary rule: if Trial-1 covers up to `2020-12-31`, then Trial-2 uses `2019-12-31` as a strict boundary.

### 1.0 Dataset generation protocol (frozen; MUST run before any W0 or trial run)

Rule:
- The dataset for this trial does not exist yet and MUST be generated via **tick loop replay**.
- No post-processing is allowed. No filtering. No re-sampling. No “fixing” of snapshots.
- Before the dataset is generated: **any exploratory run is forbidden**.

Frozen generation inputs:
- tick_interval_ms: `60000` (amended via §1.0.1 A1; original: 1000)
- inst_id: `universe_A` (SWAP)
- time window: `2018-01-01__2019-12-31` (strict boundary policy above)
- truth_profile: `replay_truth`
- output: a replay dataset directory that contains at least:
  - `dataset_manifest.json`
  - `market_snapshot.jsonl`
  - (any additional files MUST be additive-only; no mutation of `market_snapshot.jsonl`)

Frozen dataset identity fields (to be filled after generation, before any trial run):
- dataset_dir: `datasets_v12/dataset_replay_v0_SWAP_BTC-USDT-SWAP_2022-10-01__2022-12-31_bar1m`
- dataset_hash (sha256 of market_snapshot.jsonl): `593210d10f161fdd1106cf06b7db2e951773c8bb075176306ace2c5b0e7082d3`
- dataset_manifest_hash: `a71b0706d707666ea8d3feb349675ee942d6392c1ae48c77f4808f43784b564e`
- signal_p99_anchor_value: `0.05430568196465007`
- signal_p99_anchor_k_window: `500`
- anchor_computation_scope: `full_dataset`
- dataset_generated_at_utc: `2026-01-07T04:45:39.711148Z`
- dataset_record_count: `132480`

### 1.0.1 Additive-only amendment A1: tick_interval_ms correction (2026-01-07)

**Original frozen value**: `tick_interval_ms: 1000` (1 second; copied from Trial-1)

**Issue discovered during implementation**:
- OKX historical candles API (`/api/v5/market/history-candles`) does NOT support 1-second granularity for long-range historical data
- Minimum realistic bar for 2018-2020 time window: `1m` (60 seconds)
- Tool constraint: NO post-processing allowed (no interpolation, no upsampling per §1.0 Dataset generation protocol)

**Amended value**: `tick_interval_ms: 60000` (1 minute; bar=1m)

**Rationale**:
- Must use OKX native granularity (fail-closed; no synthetic data)
- Temporal structure hypothesis (r_t run-length) remains testable at 1-minute granularity
- This amendment does NOT invalidate Trial-1 (different data source: real-time tick loop at 1s granularity)

**Amendment status**: APPROVED (Option A, 2026-01-07T20:35Z)
**Tool used**: `Prometheus-Quant/tools/v12/build_replay_dataset_from_okx_history_candles_v0.py`

- dataset_dir (absolute or repo-relative path): (TBD)
- dataset_hash (sha256 of `market_snapshot.jsonl`): (TBD; MUST be recorded before W0)
- dataset_manifest_hash (sha256 of `dataset_manifest.json`): (TBD)

### 1.0.2 Additive-only amendment A1-P2: time window + dataset_id correction (OKX SWAP listing constraint + feasibility)

**Issue discovered**:
- Original frozen time window `2018-01-01__2019-12-31` is not usable for `BTC-USDT-SWAP` (instrument listing-date conflict).
- We must not fabricate pre-listing data. Also, feasibility requires a bounded window to execute the falsification protocol quickly.

**Effective window (frozen for Trial-2 dataset generation)**:
- time_window_effective: `2022-10-01__2022-12-31` (3 months)
- dataset_id_effective: `SWAP_BTC-USDT-SWAP_2022-10-01__2022-12-31`
- inst_id_effective: `BTC-USDT-SWAP`
- source_effective: `okx_history_candles`
- bar_effective: `1m` (tick_interval_ms_effective=60000)

Rule:
- The originally registered `dataset_id` remains as historical record only and MUST NOT be used to build a dataset.
- The effective values above MUST match the generated dataset's `market_snapshot.jsonl.source{kind,bar,start_utc,end_utc}` and `dataset_manifest.json`.

### 1.1 W0 gate parameters + result (frozen params; result must be recorded)

Command (same params as Trial-1):
- `python3 tools/v12/verify_world_structure_gate_v0.py --dataset_dir <DATASET_DIR> --k_windows 1,100,500 --p99_threshold 0.001 --min_samples 1000 --output <W0_REPORT.json>`

Result:
- W0 verdict: (TBD; MUST be PASS, otherwise trial is NOT_MEASURABLE and does not count)
- W0 report path: (TBD)

---

## 2) World signal (frozen)

- signal_name: `abs_log_return_k500`
- formula: `signal_t = abs(log(px_t / px_{t-500}))`
- window(s)/params: `k=500`
- missing-data rules: (TBD; must follow SSOT protocol; fail-closed)

Normalization anchor (must be shared across ON/OFF/SHUFFLE):
- signal_p99_anchor source: `dataset_precomputed`
- signal_p99_anchor value: `SEE §1.0 Frozen dataset identity fields (dataset-specific; MUST be recorded before W0)`

---

## 3) Pressure mapping (frozen; NO reward)

- energy_update_type: `action_cost` (temporal-only falsification battery)
- mapping formula from signal → g → cost (frozen):
  - `g_t = clamp(signal_t / signal_p99_anchor, 0, 1)`
  - `r_t = r_{t-1} + 1 if g_t >= g_hi else 0`
  - `cluster_penalty = uniform(0, 8) * max(0, r_t - 2)`
  - `cost_A = -(base_cost + linear_exposure)` (no cluster penalty)
  - `cost_B = -(base_cost + linear_exposure + cluster_penalty)` (B-only)
- base_cost distribution: `uniform(1.0, 3.0)`
- linear_exposure distribution: `uniform(0.0, 2.0) * g_t`
- strict ban: positive energy update (confirm): `YES`

---

## 4) Projection definition (frozen)

- projection_kind: `binary A/B`
- strategy: (TBD; must be simple & auditable; no learning)
- what is being adjudicated: `survival difference between A and B under time-aligned pressure`

---

## 5) Controls

- ON: run (required)
- SHUFFLE: run (required)
  - shuffle algorithm: `random.Random(shuffle_seed).shuffle(g_sequence_full_len_5000)`
  - shuffle_seed: `1000003 + seed` (derived; deterministic)
- OFF (ablation):
  - status: `NOT_RUN_IN_THIS_TRIAL`
  - evidence_ref: use V0.6.1 OFF evidence (see §8.2)

---

## 6) Primary metric + falsification criteria (frozen)

Primary metric name:
- `reduction_ratio`

Binary projection gap:
- `gap = extinction_tick_A - extinction_tick_B`
- `gap_on = gap(ON)`
- `gap_shuffle = gap(SHUFFLE)`
- `reduction_ratio = (gap_on - gap_shuffle) / max(1, abs(gap_on))`

Falsification rule (frozen):
- PASS criterion for this trial: `reduction_ratio >= 0.5` (per-config aggregate rule; see battery deliverable)
- D0 mapping: triggers F2 if the gap is not materially reduced under SHUFFLE by the rule above.

---

## 7) Run plan (frozen)

- seeds: 20 seeds, **disjoint** from Trial-1 and Trial-3
  - seed_range: `3001–3020`
  - seed_list: `3001,3002,3003,3004,3005,3006,3007,3008,3009,3010,3011,3012,3013,3014,3015,3016,3017,3018,3019,3020`
- steps_target: (TBD)
- early_stop: (TBD)
- expected run_dirs naming: (TBD)

---

## 8) Post-run evidence anchors (fill after completion; do not change above)

### 8.1 Trial-2 run anchors (to fill)

- runs_root: `/Users/liugang/Cursor_Store/Prometheus-Quant/runs_v12_d0_trial_2` (120 run_dirs; g_hi sweep × seeds × {on,shuffle})
- run_ids (ON): `SEE sweep_summary_json.pairs[].on_run_dir` (append-only; avoids duplicating 60 ids inline)
- run_ids (SHUFFLE): `SEE sweep_summary_json.pairs[].shuffle_run_dir` (append-only; avoids duplicating 60 ids inline)
- w0_report_path: `docs/v12/artifacts/d0/d0_trial_2/w0_report.json`
- sweep_summary_json_path: `docs/v12/artifacts/d0/d0_trial_2/trial_2_sweep_summary.json`
  - sweep_summary_sha256: `f95425801ab5d1c57f73309d22a5b4cb32c1a0099b9a3ba184a7f3cde4d420c9`
- operator_summary_json_path: `docs/v12/artifacts/d0/D0_TRIAL_2_3_COMPLETE_SUMMARY_from_operator.json`
  - operator_summary_sha256: `bf3443a9847f9b4c80d6136c6620278b83c11e4253be3a49ff0e99bf37c571f1`

### 8.2 External OFF evidence reference (frozen reference; already archived in Research)

- status: `EXTERNAL_EVIDENCE_REFERENCE`
- evidence_files (archived under Trial-1 artifacts dir):
  - `docs/v12/artifacts/d0/v0_6_3_trial_1/V0_6_1_WORLD_COUPLING_TEST_SUMMARY_2026-01-06T18:07:35.765714Z.json`
  - `docs/v12/artifacts/d0/v0_6_3_trial_1/V0_6_1_per_seed_on_off_shuffle_20seeds.json`

---

## 9) Amendments (append-only)

### 9.1 Amendment A1 — OKX history min bar=1m → dataset tick interval override

- amendment_id: `A1_okx_history_bar_1m_tick_interval_override`
- date_utc: (TBD)
- trigger: `constraint:okx_history_candles_min_granularity_1m`
- rationale (factual): OKX historical candles do not support 1s granularity for 2018-2020; min bar is 1m.

Additive-only override (for dataset generation and dataset manifest ONLY; does not retroactively change Trial-1):
- dataset_generation.source: `okx_history_candles`
- dataset_generation.bar: `1m`
- dataset_generation.dataset_tick_interval_ms_effective: `60000`
- dataset_manifest.world_contract.tick_interval_ms: `60000`

Signal/anchor discipline under 1m bar (frozen for this trial after A1):
- world signal remains: `signal_t = abs(log(px_t / px_{t-500}))` with `k=500`
  - note: with 1m bar, `k=500` corresponds to 500 minutes (documented; not treated as a free knob).
- signal_p99_anchor policy:
  - source: `dataset_precomputed`
  - MUST be computed ONCE from the full generated dataset (pre-run) and recorded before W0:
    - record in dataset_manifest (additive-only metadata is allowed; do not mutate snapshots)
    - record in this pre-reg under §1.0 "Frozen dataset identity fields (to be filled after generation, before any trial run):
- dataset_dir: `datasets_v12/dataset_replay_v0_SWAP_BTC-USDT-SWAP_2022-10-01__2022-12-31_bar1m`
- dataset_hash (sha256 of market_snapshot.jsonl): `593210d10f161fdd1106cf06b7db2e951773c8bb075176306ace2c5b0e7082d3`
- dataset_manifest_hash: `a71b0706d707666ea8d3feb349675ee942d6392c1ae48c77f4808f43784b564e`
- signal_p99_anchor_value: `0.05430568196465007`
- signal_p99_anchor_k_window: `500`
- anchor_computation_scope: `full_dataset`
- dataset_generated_at_utc: `2026-01-07T04:45:39.711148Z`
- dataset_record_count: `132480`

### 9.2 Amendment A1-P2 — OKX SWAP listing-date constraint → time window correction

- amendment_id: `A1P2_okx_swap_listing_date_time_window_correction`
- date_utc: (TBD)
- trigger: `constraint:inst_listing_date_conflict`
- rationale (factual): `BTC-USDT-SWAP` did not exist for the originally frozen window `2018-01-01__2019-12-31` (instrument listed later). We must not fabricate pre-listing data.

Additive-only overrides (effective for dataset generation; supersedes §1 window for this trial):
- inst_id_effective: `BTC-USDT-SWAP` (unchanged)
- time_window_effective: `2021-01-01__2022-12-31`
- dataset_id_effective: `SWAP_BTC-USDT-SWAP_2021-01-01__2022-12-31`

Notes (frozen after this amendment):
- The originally registered `dataset_id` remains as a historical record only; it MUST NOT be used to build a dataset.
- No overlap requirement is not needed for independence because Trial-3 uses a different inst_id; however this trial’s window is now explicitly corrected to a valid post-listing period.

### 9.3 Amendment A1-P3 — signal_p99_anchor value must be dataset-specific (remove Trial-1 carry-over)

- amendment_id: `A1P3_signal_p99_anchor_dataset_specific`
- date_utc: (TBD)
- trigger: `constraint:bar_change_and_dataset_change`
- rationale (factual): Trial-1 anchor value `0.002507` was computed from a different dataset (1s tick loop). With 1m historical candles + new time window, the anchor MUST be recomputed from the generated dataset to avoid scale drift.

Additive-only override (effective for this trial after A1-P3):
- signal_p99_anchor_value_effective: `dataset_precomputed_from_generated_dataset`
- required record (before W0):
  - signal_p99_anchor_value
  - signal_p99_anchor_k_window = `500`
  - anchor_computation_scope = `full_dataset`

