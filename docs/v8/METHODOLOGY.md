# V8.0 完整机制说明

## 📋 目录

- [系统架构](#系统架构)
- [特征维度](#特征维度)
- [决策机制](#决策机制)
- [市场模拟器](#市场模拟器)
- [生死机制](#生死机制)
- [繁殖机制](#繁殖机制)
- [神秘维度](#神秘维度)

---

## 系统架构

### 核心理念

**零策略、零风控、纯演化**

这个系统**没有任何预设的交易策略**，也**没有任何风控规则**（除了破产淘汰）。所有的"策略"都是在生存压力下，通过自然选择涌现出来的。

---

## 特征维度

### 对齐维度（Aligned Dimensions）：31维

**总维度数**：31维  
**索引范围**：[0-30]

**详细分组**：

| 索引范围 | 维度名称 | 维度数 | 说明 |
|---------|---------|-------|------|
| [0-4] | 价格维度 | 5维 | 当前价格、开盘价、最高价、最低价、收盘价 |
| [5-7] | 成交量维度 | 3维 | 成交量、成交额、换手率 |
| [8-9] | 短期价格变化 | 2维 | 价格涨跌幅、价格波动率 |
| [10-14] | 订单簿深度 | 5维 | 买卖盘口深度、订单失衡度等 |
| [15-16] | 交易流 | 2维 | 买卖交易流强度 |
| [17-19] | 摩擦系数 | 3维 | 滑点、手续费、市场冲击成本 |
| [20-22] | 系统与市场特征 | 3维 | 市场状态、系统资金、种群规模 |
| [23-25] | 高级微结构特征 | 3维 | 市场微观结构特征 |
| **[26-30]** | **Agent自身状态** | **5维** | **核心：Agent的自我感知** |

**Agent自身状态（5维）**：
- `[26]` **has_position** - 是否有持仓（0/1）
- `[27]` **position_pnl_pct** - 持仓盈亏百分比
- `[28]` **holding_duration** - 持仓时长（周期数）
- `[29]` **leverage_appetite** - 杠杆偏好（历史行为统计）
- `[30]` **last_signal** - 上一次交易信号（-1到+1）

---

### 神秘维度（Mystery Dimensions）：0-32维

**初始数量公式**：
```
mystery_dimensions = int(31 × mystery_ratio)
```

其中 `mystery_ratio ∈ [0, 1]`（初始随机）

**理论范围**：0-31维  
**实际观测范围**：0-32维（基因变异可使维度±1，概率5%）

**关键特性**：
- 初始时完全随机
- 不与任何已知特征对齐
- 可以随繁殖变异（±1维，5%概率）
- 无性繁殖时完全重新随机

**演化发现**：
- 在温和环境（黑天鹅±5%-15%），收敛到**0-3维**
- 在残酷环境（黑天鹅±15%-30%），收敛到**7-9维**
- 在中等环境（黑天鹅±10%-20%），会走向**高维陷阱**（13-14维）

---

## 决策机制

### 线性加权（Linear Weighting）

**最小公理**：Agent的行为由基因权重与特征的线性组合决定。

```python
# 伪代码
signal = 0.0

# 对齐维度投票（31维）
for i in range(31):
    signal += aligned_genes[i] × features[i]

# 神秘维度投票（0-32维）
for j in range(len(mystery_genes)):
    signal += mystery_genes[j] × random_value[j]

# 归一化到 [-1, +1]
signal = tanh(signal)
```

**信号含义**：
- `signal = +1.0`：满仓做多
- `signal = 0.0`：空仓
- `signal = -1.0`：满仓做空

**无策略逻辑**：
- 没有"MA金叉做多"
- 没有"RSI超买减仓"
- 没有"止损止盈"
- 只有：权重 × 特征 = 信号

---

## 市场模拟器

### 特征生成

每个周期，模拟器生成**26维市场特征向量**（索引[0-25]），Agent将其与自身5维状态（索引[26-30]）合并为完整的**31维特征向量**。

### 市场状态（4种）

| 状态 | 英文 | 特征 |
|------|------|------|
| 趋势 | Trending | 单向波动，低波动率 |
| 震荡 | Ranging | 横盘波动，中等波动率 |
| 高波动 | Volatile | 剧烈波动，高波动率 |
| 反转 | Reversal | 趋势反转，快速变化 |

**状态切换概率**：3%（每周期）

### 黑天鹅事件

**触发概率**：0.2%（温和版）、0.35%（中等版）、0.5%（残酷版）  
**冲击幅度**：
- 温和版：±5%-15%
- 中等版：±10%-20%
- 残酷版：±15%-30%

**平均频率**：
- 温和版：约500周期/次
- 中等版：约286周期/次
- 残酷版：约200周期/次

---

## 生死机制

### 死亡方式（2种）

#### 1. 破产死亡（Bankruptcy Death）

**触发条件**：
```python
total_equity = virtual_capital + unrealized_pnl
if total_equity < initial_capital × 0.1:
    die(reason="bankruptcy")
```

**特点**：
- 无年龄限制
- 每周期检查
- 任何Agent都可能破产

---

#### 2. Moirai死亡（Fate Death）

**触发条件**：
- 仅针对**年龄 ≥ 50周期**的Agent
- 根据系统资金状况动态调整死亡概率
- 被选中的Agent以"retired"状态终止

**保护机制**：
- 年龄 < 50周期的Agent受到**成年保护**
- 保护期内不会被Moirai操作
- 只可能因破产死亡

**Moirai的智慧**：
> "死亡无意义，新生无意义，存在就是意义。"
> 
> —— Moirai，命运三女神

---

## 繁殖机制

### 繁殖条件

**年龄要求**：≥ 50周期  
**概率调节**：根据系统资金动态调整

### 繁殖方式（2种）

#### 1. 有性繁殖（Sexual Reproduction）

**配偶匹配条件**：
```python
partner_dimension = aligned_dimensions + mystery_dimensions
self_dimension = aligned_dimensions + mystery_dimensions

if partner_dimension == self_dimension:
    # 可以交配
```

**基因遗传**：
- `aligned_genes` 通过交叉（crossover）继承
- `mystery_genes` 通过交叉（crossover）继承
- 分别独立进行

**基因变异**：
- `aligned_genes`：10%概率变异
- `mystery_dimensions`：5%概率 ±1维

---

#### 2. 无性繁殖（Asexual Reproduction）

**触发条件**：找不到同维度配偶

**基因处理**：
- `aligned_genes`：复制并变异（10%概率）
- `mystery_ratio`：**完全重新随机**（0-1之间）

**多样性关键**：无性繁殖时，神秘维度的比例完全重置，这是系统引入多样性的核心机制！

---

### 新生Agent

**初始状态**：
- 年龄 = 0
- 享有**50周期成年保护期**
- 初始资金 = 系统标准资金

---

## 神秘维度

### 哲学悖论

**如果它是"神秘的"，怎么能被测量？**  
**如果它被测量了，它还"神秘"吗？**

### 当前理解

我们测量的可能不是"市场的暗物质"，而是：
- 随机噪声的分布
- 模型对"自由度"的需求
- 演化对"否决机制"的选择

### 实验观测

| 环境 | 黑天鹅强度 | 收敛维度 | 系统状态 |
|------|-----------|---------|---------|
| 温和 | ±5%-15% | 0-3维 | ✅ 稳定 |
| 中等 | ±10%-20% | 13-14维 | ❌ 长寿后崩溃 |
| 残酷 | ±15%-30% | 7-9维 | ❌ 快速崩溃 |

**长寿悖论**：中等环境活得最久（155,000周期），但最终崩溃且无火种留存。温和环境只活了98,809周期，但系统稳定且火种健康。

---

## 总结

这个系统的全部机制，没有任何交易策略，没有任何风控（除了破产淘汰）。

**就这些。**

**然后，演化告诉我们答案。**

---

## 相关文档

- [V8.0 方法论](V8.md)
- [黑天鹅对比实验](../../V8_BLACK_SWAN_COMPARISON_REPORT.md)
- [最优平衡点分析](../../V8_OPTIMAL_BALANCE_POINT_ANALYSIS.md)
- [40万周期完整生命史](../../V8_COMPLETE_LIFE_HISTORY_ANALYSIS.md)

