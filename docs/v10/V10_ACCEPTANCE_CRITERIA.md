# V10 方法论工程验收标准（审查者版本）

> 目的：把“测量复杂系统的方法”从哲学叙事，落到**可复现、可审计、可证伪**的工程验收协议。  
> 立场：不预设“涌现应当长成什么样”。只裁决：系统是否确实利用了市场时间结构，并且结论在对照/消融下成立。

---

## 0. 总目标（裁决口径：以量化交易为实例的工程审查）

**方法有效** ≈ 在严格的可复现与可审计前提下：

- 在**真实时间结构**数据（A组）上，持续出现“利用时间结构”的证据；
- 在**零假设对照**（B组，破坏时间结构但保持单步波动分布）上，该证据显著变弱或消失；
- 在**消融/扰动**（C组）下，该证据按预期退化；
- 全流程不存在“口径错误/数值爆炸/账本不闭合”这类工程幻觉。

> 说明：我们用“量化交易”作为实例来检验演化方法论，因此裁判尺度必须来自交易世界的硬约束（净值、回撤、摩擦、强平、可持续性、可对账）。  
> 这里的“有效”不是“证明真理”，而是获得工程意义上的可信度增量。

---

## 1. Gate 0：工程与会计完整性（硬门槛）

任一项失败，直接判定本轮实验**无效**（先修尺子，再谈结论）。

- **G0.1 可复现**
  - 同一 commit + 同一 config + 同一 seed + 同一数据窗口 → 关键统计一致（允许浮点微差，但需在阈值内）。

- **G0.2 可审计（落盘，不只终端）**
  - 每次运行输出的 JSON/报告中必须包含：
    - 配置（阈值、agent数、ticks、seed列表、数据文件与时间窗）
    - 资金三元组：`allocated_capital / system_reserve / current_total`
    - 下葬与崩溃事件（时间戳/计数/原因）
    - 审计声明（mode、资金模型语义、下葬契约版本等）

- **G0.3 数值健康**
  - 不允许出现 `NaN/Inf/溢出`。出现即判该 run 作废，并必须定位原因。
  - **对照组构造不物理**导致溢出，也属于失败（对照无效）。

- **G0.4 统计口径正确**
  - 盈利/ROI等统计必须同时覆盖：
    - **全体（含死亡）**：例如 `profitable_agents_all`
    - **存活子集**：例如 `profitable_agents_alive`
  - 禁止混淆（例如把 `alive` 当分母导致“存活=盈利”的假象）。

- **G0.5 对照组物理合理**
  - 零假设必须破坏时间结构，但不能引入“现实中不可能的巨大跳变频率”。

- **G0.6 禁止“隐含预设策略”（Prior leakage audit）**
  - 目的：避免“尺子里塞了策略”，把后续所有 A/B 裁决污染掉。
  - 最低要求（任一失败 → 本轮实验无效）：
    - **特征侧**：不得直接硬编码典型交易指标/策略公式（如 RSI/MACD/均线交叉/专用微结构识别器）。允许“原始观测”与“物理可解释的变换”（归一化、tanh压缩、EMA平滑）——但必须在文档中声明。
    - **表达/执行侧**：不得用硬阈值把某种交易风格写死（除“生态/物理规则”外）；若存在硬阈值，必须列出清单并在 Gate 3 做消融验证。
    - **死基因/冗余维度**：如果基因包含不再生效的维度（例如阈值被路线升级后废弃），必须显式标注，否则“基因维度最小化”判定失败。

---

## 2. Gate 1：非随机性（必须有对照）

**核心问题**：系统的表现差异是否来自“时间结构”，而不是噪声/偶然。

### 2.1 实验组与对照组（最低配置）

- **A组（真实时间结构）**：真实历史数据原序列。
- **B组（零假设）**：破坏时间顺序，但保持单步波动分布近似真实。
  - 推荐：**打乱收益率（return/log-return）序列后重建价格**，而不是直接随机置换价格。

> 若B组跑不通或数值爆炸：对照无效，Gate 1 不能裁决。

### 2.2 主指标（Primary endpoints，已锁定）

为避免“挑好看的指标”，必须**预先固定**主指标（建议选2个，最多3个）。本项目现阶段锁定为2个：

- **Primary #1：`system_roi`（基于`current_total`）**
  - 定义：`system_roi = current_total / initial_total_capital - 1`
  - 口径：`current_total = allocated_capital + system_reserve`
- **Primary #2：`extinction_rate`（灭绝比例）**
  - 定义：`alive_agents == 0` 的 run 占比

> 说明：`profitable_agents_all` 对结构更敏感，但容易被“刷微利/阈值抖动”误导，因此降级为次指标（Secondary）。

### 2.2.1 次指标（Secondary endpoints，建议保留但不作为通过/失败唯一依据）

- **`profitable_agents_all`**：全体盈利人数/比例（含死亡）
- **回撤类**：`max_drawdown`（至少给分位数或置信区间）
- **换手/交易摩擦代理**：`total_trades`、（如可得）`avg_M7 / avg_M9`
- **存活结构**：`avg_alive_agents`、`avg_total_agents`（总谱系规模）

### 2.3 统计判定（建议）

对每个主指标，比较 A vs B：

- 连续指标（如`system_roi`、盈利人数）：推荐 **Mann–Whitney U**（非参数，稳健）。
- 比例指标（如灭绝率）：推荐 **费舍尔精确检验**或比例检验。

**通过条件**（工程审查线，非真理）：

- 统计显著：`p < 0.05`（多指标需多重校正或只对主指标检验）
- 同时具备**最小效应量**（例如 `system_roi` 差异 ≥ 2pp；或盈利人数差异 ≥ 50%）

---

## 3. Gate 2：稳健性（可重复、可迁移、不靠偶然）

- **G2.1 seed规模**
  - 建议 `n_seeds >= 30`（至少30；更强建议50/100用于稳定性评估）。

- **G2.2 稳定性呈现**
  - 不只给均值：必须给中位数/分位数/置信区间，避免被极端值带偏。

- **G2.3 时间窗迁移**
  - 至少两个不重叠窗口（或两种市场状态窗口）中，A>B结论方向一致。

- **G2.4 避免信息泄漏**
  - 禁止使用未来信息（包括归一化、滚动窗口实现错误等）。

---

## 4. Gate 3：因果归因（消融/扰动）

**目的**：证明你测到的差异来自你声称的观测通道，而不是隐藏漏洞。

- **G3.1 观测通道消融（ablation）**
  - 例：将某一类输入置空（如 `M={}` 或 `C={}`）。
  - 预期：A>B 的主指标差异应显著减弱或消失。

- **G3.2 小扰动敏感性**
  - 对关键阈值做小范围扰动（例如 ±20%），结论不应完全翻盘。

- **G3.3 Prior leakage 消融（强制）**
  - 目的：证明你看到的差异不是“隐含预设”带来的假阳性。
  - 最低两组（建议都做 A vs B）：
    - **M消融**：`M={}`（或全部置零） → 若 A>B 信号主要靠 M 通道，应显著退化。
    - **C消融**：`C={}`（或全部置零） → 若 A>B 信号主要靠群体态，应显著退化。
  - 输出：把“消融前后”主指标差异（均值/中位数/分位数 + p值 + 效应量）写入裁决摘要。

---

## 5. Gate 4：走向虚拟盘/实盘的最低可用门槛（非盈利门槛）

通过 Gate 1–3 之后，才讨论是否进入虚拟盘/实盘工程。

- **G4.1 运行稳定**
  - 无刷屏、无溢出、无长期无意义循环（崩溃后应停止或只打印一次）。

- **G4.2 产物可管理**
  - 所有关键指标落盘、可聚合、可复核（不靠grep挖日志）。

- **G4.3 执行环境指纹测试（若上OKX demo/live）**
  - 以极小额订单测量：滑点分布、部分成交比例、延迟分布、fee一致性，并落盘。

---

## 6. 最终裁决输出格式（强制）

每轮验收必须输出“一页裁决摘要”（Markdown或JSON均可）：

- Gate 0–4：逐项 **Pass/Fail**（Fail必须给原因与复核路径/命令）
- A vs B：主指标的均值/中位数/分位数 + p值 + 效应量
- 结论：**通过 / 不通过 / 证据不足**
- 下一步：只允许提出**最小改动**（优先补证据，不优先改世界规则）

---

## 7. 待确认项（剩余需锁定）

- **对照组B的生成方式与参数**：默认采用“打乱log-return重建价格”的方案。
- **最小效应量阈值**：例如system_roi差异≥2pp、盈利人数差异≥50%等。


