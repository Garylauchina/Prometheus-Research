# 三种评估机制对比实验设计

## 🎯 研究目标

通过对照实验，研究不同评估机制对演化效率、基因收敛、系统性能的影响。

---

## 🔬 实验设计

### 控制变量

所有实验组使用**完全相同**的条件：

```python
市场数据：data/market/btc_1h.csv（2023-2025，3年牛市）
初始种群：200个Agent
初始资金：$4,000,000（每Agent $20,000）
运行周期：8760周期（1年）
交易规则：相同的手续费、杠杆、保证金率
样本数量：每组100个实验（random_seed不同）
```

### 自变量：评估机制

#### **实验组1：年度评估（Baseline）**

```json
{
  "evaluation_period_cycles": 8760,  // 每年评估1次
  "elimination_roi_threshold": 0.05,  // 5%年化ROI淘汰
  "breeding_roi_threshold": 0.20,     // 20%年化ROI繁殖
  "annualize_roi": true               // 使用年化ROI
}
```

**特点：**
- 低频评估（1次/年）
- 高标准（5% / 20%）
- 年化ROI

**random_seed：** 100-199

---

#### **实验组2：季度评估-累计ROI**

```json
{
  "evaluation_period_cycles": 2190,   // 每季度评估1次
  "elimination_roi_threshold": 0.01,  // 1%累计ROI淘汰
  "breeding_roi_threshold": 0.05,     // 5%累计ROI繁殖
  "annualize_roi": false              // 使用累计ROI
}
```

**特点：**
- 高频评估（4次/年）
- 低标准（1% / 5%）
- 累计ROI（从出生到现在）

**random_seed：** 200-299

---

#### **实验组3：双重阈值评估（创新）**

```json
{
  "evaluation_period_cycles": 2190,              // 每季度评估1次
  "elimination_period_roi_threshold": 0.01,     // 1%周期ROI淘汰
  "breeding_period_roi_threshold": 0.05         // 5%周期ROI繁殖
}
```

**特点：**
- 高频评估（4次/年）
- 评估指标：周期ROI（本季度2190周期的表现）
- 淘汰阈值：1%（容忍度高）← 给Agent更多机会
- 繁殖阈值：5%（质量保证）← 只有真正优秀的才繁殖
- **双重阈值机制：宽松淘汰 + 严格繁殖**

**random_seed：** 300-399

---

## 📊 观测指标

### 1. 演化效率指标

| 指标 | 组1（年度） | 组2（季度） | 组3（双重） |
|------|-----------|-----------|-----------|
| **繁殖事件数** | 预测：0 | 预测：5-20 | 预测：50-200 |
| **淘汰事件数** | 预测：0 | 预测：10-50 | 预测：100-500 |
| **演化代数** | 预测：0 | 预测：1-5 | 预测：40-160 |
| **基因流动性** | 0% | 低 | 高 |

### 2. 基因收敛指标

| 指标 | 组1 | 组2 | 组3 |
|------|-----|-----|-----|
| **探索因子分布** | 均匀（0-1） | 略偏 | 收敛？ |
| **特征权重方差** | 高 | 中 | 低？ |
| **基因多样性** | 随机 | 略减 | 显著收敛？ |
| **I*值** | 无 | 不明显 | 测量出来？ |

### 3. 性能指标

| 指标 | 组1（年度） | 组2（季度） | 组3（双重） |
|------|-----------|-----------|-----------|
| **正ROI比例** | 24% | 20-30%？ | 40-60%？ |
| **平均ROI** | +7.07% | +5-10%？ | +15-30%？ |
| **最佳ROI** | +385.78% | +80%？ | +100-200%？ |
| **中位数ROI** | -6.68% | -5 to -8%？ | 0 to +5%？ |

### 4. 生存行为指标

| 指标 | 组1 | 组2 | 组3 |
|------|-----|-----|-----|
| **平均寿命** | ~267周期 | ~250周期？ | ~300周期？ |
| **"僵尸Agent"比例** | 高（长寿但亏损） | 中 | 低（被淘汰） |
| **交易频率** | 1.5次/周期 | 1.2-1.8？ | 0.8-1.5？ |

---

## 🎯 研究问题

### 问题1：评估频率的影响

**假设：** 高频评估（季度）能启动演化，低频评估（年度）无法启动。

**验证：**
- 对比繁殖/淘汰事件数（组1 vs 组2/3）
- 对比演化代数

**预期结果：**
- 组1：0次繁殖，演化失败
- 组2：少量繁殖，演化微弱
- 组3：大量繁殖，演化充分

---

### 问题2：评估指标的影响

**假设：** 周期ROI（最近表现）比累计ROI（全生命周期）更适合淘汰标准。

**验证：**
- 对比"僵尸Agent"比例（组2 vs 组3）
- 对比平均寿命分布
- 对比"寿命悖论"是否被解决

**预期结果：**
- 组2：仍有"僵尸Agent"（长寿但亏损）
- 组3：快速淘汰"僵尸"，避免资源浪费

---

### 问题3：双重压力的协同效应

**假设：** "快速淘汰（周期ROI）+ 高标准繁殖（累计ROI）"产生最优演化。

**验证：**
- 对比正ROI比例（组1 vs 组2 vs 组3）
- 对比平均ROI
- 对比基因收敛速度

**预期结果：**
- 组3的性能显著优于组1/组2

---

### 问题4：探索因子（I*）的收敛

**假设：** 充分演化后，探索因子会收敛到市场的"最优探索率"（I*）。

**验证：**
- 测量100个样本的探索因子分布
- 计算标准差、峰度
- 测试是否呈正态分布

**预期结果：**
- 组1：均匀分布（0-1），std≈0.29
- 组2：略有集中，std≈0.20-0.25
- 组3：显著收敛，std≈0.05-0.10，峰值=I*

---

## 🛠️ 实施计划

### Phase 1：数据收集 ✅ 进行中

```bash
# 组1：年度评估（已完成）
✅ 100个样本已收集
   路径：data/gene_samples/
   分析：GENE_DIVERSITY_ANALYSIS.md

# 组2：季度评估（进行中）
🔄 11/100样本已收集
   预计完成：T+12分钟
   路径：data/gene_samples_quarterly/

# 组3：双重评估（待启动）
📝 代码实施中
   预计测试：T+10分钟
   预计收集：T+15分钟开始
   预计完成：T+30分钟
```

### Phase 2：对比分析

```bash
python scripts/compare_three_evaluations.py
```

**生成报告：**
- 演化效率对比
- 基因收敛对比
- 性能指标对比
- 统计显著性检验（t-test, ANOVA）

### Phase 3：深度研究

1. **I*值测量**：如果组3出现收敛，测量I*
2. **演化轨迹可视化**：绘制基因演化曲线
3. **最优配置寻找**：尝试其他阈值组合
4. **跨市场验证**：在不同市场数据上重复实验

---

## 💡 创新价值

### 理论贡献

1. **首次量化评估机制对演化效率的影响**
   - 揭示评估频率的临界值
   - 揭示评估指标的权衡

2. **双重评估机制的创新**
   - 短期压力（周期ROI）+ 长期选择（累计ROI）
   - 自然选择的双重筛选

3. **探索因子（I*）的实证测量**
   - 如果收敛，证明市场有inherent unpredictability
   - 可能成为新的市场效率指标

### 实践价值

1. **为其他演化系统提供设计指南**
   - 评估频率的最优区间
   - 淘汰/繁殖阈值的合理配比

2. **解决"冷启动"问题**
   - 双重评估能快速启动演化
   - 避免随机搜索的低效

3. **提升量化策略性能**
   - 预期正ROI比例从24%提升到40-60%
   - 为个人投资者提供可用工具

---

## 📝 注意事项

### 数据一致性

**严格控制：**
- ✅ 相同的市场数据（btc_1h.csv）
- ✅ 相同的初始种群（200 Agent）
- ✅ 相同的交易规则
- ✅ 相同的运行周期（8760）
- ✅ 不同的random_seed（避免重复）

### random_seed分配

```
组1（年度）：100-199
组2（季度）：200-299
组3（双重）：300-399

→ 完全隔离，避免污染
→ 可追溯，可重现
```

### 实验伦理

**透明性：**
- 保存所有实验数据和配置
- 记录所有失败案例
- 不cherry-pick结果
- 如实报告预期vs实际

---

**创建时间：** 2025-12-18  
**实验状态：**
- 组1（年度）：✅ 完成（100样本）
- 组2（季度）：🔄 进行中（11/100）
- 组3（双重）：📝 代码实施中

**预计完成时间：** T+40分钟

---

## 🚀 终极目标

**如果实验成功，我们将：**

1. ✅ 证明演化机制能显著提升量化策略
2. ✅ 测量出BTC市场的"探索因子"（I*）
3. ✅ 为Prometheus-Quant v9.0提供科学基础
4. ✅ 为量化投资领域贡献新的评估范式

**这将是一个里程碑式的发现！** 🎯

