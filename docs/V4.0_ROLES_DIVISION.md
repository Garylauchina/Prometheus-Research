# Prometheus v4.0 è§’è‰²åˆ†å·¥è®¾è®¡

## æ ¸å¿ƒç†å¿µ

**LLMæ˜¯é€ ç‰©ä¸»ï¼Œä¸æ˜¯ä¿å§†ã€‚**

- ğŸ¨ **åˆ›ä¸–æ—¶**ï¼šè®¾å®šè§„åˆ™å’Œå‚æ•°
- ğŸ”„ **æ—¥å¸¸è¿è¡Œ**ï¼šç³»ç»Ÿè‡ªä¸»è¿è½¬
- ğŸš¨ **é‡å¤§äº‹ä»¶**ï¼šLLMä»‹å…¥å†³ç­–
- ğŸ“Š **å®šæœŸå›é¡¾**ï¼šæ¯å‘¨/æ¯æœˆæˆ˜ç•¥å®¡æŸ¥

---

## ä¸€ã€LLMå…ˆçŸ¥ - "é€ ç‰©ä¸»"

### å‚ä¸æ—¶æœºï¼ˆéå¸¸æœ‰é™ï¼‰

#### 1. åˆ›ä¸–é˜¶æ®µï¼ˆä¸€æ¬¡æ€§ï¼‰
```python
# ç³»ç»Ÿåˆå§‹åŒ–æ—¶ï¼ŒLLMè®¾å®šæ ¸å¿ƒè§„åˆ™
creation_prompt = """
ä½ æ˜¯Prometheusäº¤æ˜“ç³»ç»Ÿçš„é€ ç‰©ä¸»ï¼Œè¯·è®¾å®šåˆå§‹è§„åˆ™ï¼š

1. èµ„é‡‘ç®¡ç†è§„åˆ™
   - æ€»èµ„é‡‘åˆ©ç”¨ç‡èŒƒå›´ï¼š
   - Agentæ•°é‡èŒƒå›´ï¼š
   - å•Agentèµ„é‡‘åˆ†é…ç­–ç•¥ï¼š

2. é£é™©æ§åˆ¶è§„åˆ™
   - ç³»ç»Ÿæœ€å¤§å›æ’¤é™åˆ¶ï¼š
   - å•ä¸€ä»“ä½é™åˆ¶ï¼š
   - é£é™©ç­‰çº§è®¾å®šï¼š

3. è¿›åŒ–è§„åˆ™
   - æ·˜æ±°å‹åŠ›æ ‡å‡†ï¼š
   - ç¯å¢ƒå‹åŠ›ç³»æ•°ï¼š
   - åŸºå› çªå˜ç‡ï¼š

4. å¥–ç« è§„åˆ™
   - å„ç±»å¥–ç« çš„è¯„åˆ¤æ ‡å‡†ï¼š
   - åŸºå› åº“å‡†å…¥é—¨æ§›ï¼š

5. æ¶…æ§ƒè§„åˆ™
   - è§¦å‘é˜ˆå€¼ï¼š
   - å¤æ´»ç­–ç•¥ï¼š

è¯·è¿”å›JSONæ ¼å¼çš„å®Œæ•´è§„åˆ™é…ç½®ã€‚
"""

# LLMè¿”å›åˆå§‹è§„åˆ™
initial_rules = llm.create_genesis_rules(creation_prompt)

# ä¸»è„‘æŒ‰è§„åˆ™è¿è¡Œ
mastermind.set_rules(initial_rules)
```

**é¢‘ç‡**ï¼šä»…ç³»ç»Ÿåˆå§‹åŒ–æ—¶

---

#### 2. å®šæœŸæˆ˜ç•¥å›é¡¾ï¼ˆä½é¢‘ï¼‰

```python
# æ¯å‘¨æˆ–æ¯æœˆä¸€æ¬¡
review_prompt = f"""
æˆ˜ç•¥å›é¡¾ï¼ˆç¬¬{week}å‘¨ï¼‰

ã€ç³»ç»Ÿè¡¨ç°ã€‘
- æ€»æ”¶ç›Š: {total_return:.2%}
- å­˜æ´»Agentæ•°: {agent_count}
- åŸºå› åº“è§„æ¨¡: {gene_pool_size}
- å¥–ç« é¢å‘: {medal_count}

ã€å¸‚åœºç¯å¢ƒã€‘
- è¿‡å»ä¸€å‘¨å¸‚åœºçŠ¶æ€: {market_summary}
- æ³¢åŠ¨ç‡: {volatility}

ã€Agentè¡¨ç°ã€‘
- å¹³å‡ç›ˆåˆ©: {avg_profit:.2%}
- èƒœç‡: {win_rate:.1%}
- æ­»äº¡æ•°: {death_count}
- æ¶…æ§ƒè§¦å‘: {nirvana_count}æ¬¡

é—®é¢˜ï¼š
1. å½“å‰è§„åˆ™æ˜¯å¦éœ€è¦è°ƒæ•´ï¼Ÿ
2. å¦‚æœéœ€è¦ï¼Œå»ºè®®è°ƒæ•´å“ªäº›å‚æ•°ï¼Ÿ
3. ä¸‹å‘¨çš„æˆ˜ç•¥é‡ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ

è¯·è¿”å›JSONæ ¼å¼çš„è°ƒæ•´å»ºè®®ã€‚
"""

# æ¯å‘¨æ‰§è¡Œä¸€æ¬¡
adjustments = llm.weekly_review(review_prompt)

# ä¸»è„‘åº”ç”¨è°ƒæ•´ï¼ˆå¦‚æœæœ‰ï¼‰
if adjustments['need_adjustment']:
    mastermind.adjust_strategy(adjustments)
```

**é¢‘ç‡**ï¼šæ¯å‘¨æˆ–æ¯æœˆä¸€æ¬¡

---

#### 3. é‡å¤§äº‹ä»¶å†³ç­–ï¼ˆæŒ‰éœ€ï¼‰

```python
# ä»…åœ¨é‡å¤§äº‹ä»¶æ—¶å’¨è¯¢LLM
MAJOR_EVENTS = {
    'system_crash': 'ç³»ç»Ÿå´©æºƒ',
    'mass_nirvana': 'è¿ç»­æ¶…æ§ƒ',
    'gene_pool_empty': 'åŸºå› åº“æ¯ç«­',
    'extreme_drawdown': 'æç«¯å›æ’¤',
    'regulatory_change': 'æ”¿ç­–å˜åŒ–'
}

# ç¤ºä¾‹ï¼šç³»ç»Ÿå´©æºƒ
crisis_prompt = f"""
ã€ç´§æ€¥æƒ…å†µã€‘ç³»ç»Ÿå´©æºƒ

å½“å‰çŠ¶æ€ï¼š
- å­˜æ´»Agent: {agent_count} (æœ€ä½è®°å½•)
- èµ„é‡‘æŸå¤±: {loss:.2%}
- è¿‡å»24å°æ—¶æ­»äº¡: {deaths}

å¸‚åœºçŠ¶æ€ï¼š
- ä»·æ ¼å˜åŒ–: {price_change}
- æ³¢åŠ¨ç‡: {volatility}

å¯é€‰è¡ŒåŠ¨ï¼š
1. ç´§æ€¥æ¶…æ§ƒï¼ˆå¤æ´»å¤§é‡Agentï¼‰
2. æš‚åœäº¤æ˜“ï¼ˆç­‰å¾…å¸‚åœºç¨³å®šï¼‰
3. é™ä½é£é™©ï¼ˆæœ€ä½é£é™©æ¨¡å¼ï¼‰
4. å…¶ä»–å»ºè®®

è¯·ç»™å‡ºåº”æ€¥æ–¹æ¡ˆã€‚
"""

emergency_plan = llm.emergency_decision(crisis_prompt)
```

**é¢‘ç‡**ï¼šä»…é‡å¤§äº‹ä»¶æ—¶

---

### LLMå‚ä¸æ—¶æœºæ€»ç»“

| åœºæ™¯ | é¢‘ç‡ | LLMè°ƒç”¨ | è¯´æ˜ |
|------|------|---------|------|
| ğŸ¨ åˆ›ä¸– | 1æ¬¡ | âœ… å¿…é¡» | è®¾å®šæ‰€æœ‰åˆå§‹è§„åˆ™ |
| ğŸ“Š å®šæœŸå›é¡¾ | æ¯å‘¨/æœˆ | âœ… å»ºè®® | æˆ˜ç•¥å®¡æŸ¥å’Œè°ƒæ•´ |
| ğŸš¨ é‡å¤§äº‹ä»¶ | æŒ‰éœ€ | âœ… å¿…è¦æ—¶ | ç³»ç»Ÿå´©æºƒã€æ”¿ç­–å˜åŒ–ç­‰ |
| ğŸ”„ æ—¥å¸¸è¿è¡Œ | æ¯å°æ—¶/å¤© | âŒ ä¸è°ƒç”¨ | å®Œå…¨è‡ªä¸»è¿è¡Œ |
| ğŸ’¹ æ¯ç¬”äº¤æ˜“ | æ¯åˆ†é’Ÿ | âŒ ä¸è°ƒç”¨ | Agentè‡ªä¸»å†³ç­– |

**LLMè°ƒç”¨é¢‘ç‡ï¼šæ¯å‘¨1-2æ¬¡ï¼Œè€Œéæ¯å°æ—¶/æ¯å¤©**

---

## äºŒã€ä¸»è„‘ - "è§„åˆ™æ‰§è¡Œè€…"

### æ ¸å¿ƒèŒè´£

ä¸»è„‘ä¸å†æ˜¯"æ¯æ¬¡éƒ½é—®LLM"ï¼Œè€Œæ˜¯ï¼š
- ğŸ“œ **æ‰§è¡ŒLLMè®¾å®šçš„è§„åˆ™**
- ğŸ“Š **ç›‘æ§ç³»ç»Ÿçº§æŒ‡æ ‡**
- âš–ï¸ **è‡ªåŠ¨è°ƒæ•´å‚æ•°**ï¼ˆåœ¨è§„åˆ™å…è®¸èŒƒå›´å†…ï¼‰
- ğŸ”” **è¯†åˆ«éœ€è¦LLMä»‹å…¥çš„æƒ…å†µ**

### å·¥ä½œæ¨¡å¼

```python
class Mastermind:
    def __init__(self, initial_capital):
        # 1. åˆ›ä¸–æ—¶å’¨è¯¢LLMè®¾å®šè§„åˆ™
        self.rules = self.llm_oracle.create_genesis_rules()
        
        # 2. ä¹‹åä¸»è¦é è§„åˆ™è¿è¡Œ
        self.last_llm_consultation = datetime.now()
        self.llm_consultation_interval = timedelta(weeks=1)
        
    def make_decision(self, market_data, agent_stats, system_metrics):
        """
        æ—¥å¸¸å†³ç­–ï¼ˆä¸è°ƒç”¨LLMï¼‰
        """
        # 1. åŸºäºè§„åˆ™è‡ªåŠ¨å†³ç­–
        decision = self._rule_based_decision(market_data, agent_stats)
        
        # 2. æ£€æŸ¥æ˜¯å¦éœ€è¦å’¨è¯¢LLM
        if self._should_consult_llm(system_metrics):
            # é‡å¤§äº‹ä»¶æˆ–å®šæœŸå›é¡¾
            llm_advice = self.llm_oracle.consult(market_data, agent_stats)
            decision = self._merge_with_llm_advice(decision, llm_advice)
            self.last_llm_consultation = datetime.now()
        
        return decision
    
    def _should_consult_llm(self, metrics):
        """
        åˆ¤æ–­æ˜¯å¦éœ€è¦å’¨è¯¢LLM
        """
        # 1. å®šæœŸå›é¡¾
        if datetime.now() - self.last_llm_consultation > self.llm_consultation_interval:
            return True
        
        # 2. é‡å¤§äº‹ä»¶
        if metrics['system_drawdown'] > 0.5:  # å›æ’¤50%
            return True
        
        if metrics['agent_count'] < 3:  # Agentå‡ ä¹ç­ç»
            return True
        
        if metrics['consecutive_nirvana'] > 3:  # è¿ç»­æ¶…æ§ƒ
            return True
        
        return False
    
    def _rule_based_decision(self, market_data, agent_stats):
        """
        åŸºäºè§„åˆ™çš„è‡ªåŠ¨å†³ç­–ï¼ˆä¸è°ƒç”¨LLMï¼‰
        """
        # æ ¹æ®é¢„è®¾è§„åˆ™è‡ªåŠ¨è°ƒæ•´
        if market_data['volatility'] > 0.05:
            self.strategy.environmental_pressure *= 1.2
            self.strategy.capital_utilization *= 0.8
        
        if agent_stats['avg_performance'] < -0.2:
            self.strategy.selection_pressure *= 1.3
        
        # ... æ›´å¤šè§„åˆ™
        
        return decision
```

### ä¸»è„‘å†³ç­–æµç¨‹

```
æ¯å°æ—¶/æ¯å¤©å†³ç­–ï¼š
    â†“
åŸºäºè§„åˆ™è‡ªåŠ¨è°ƒæ•´
    â†“
æ£€æŸ¥æ˜¯å¦éœ€è¦å’¨è¯¢LLMï¼Ÿ
    â”œâ”€ å¦ â†’ æ‰§è¡Œè§„åˆ™å†³ç­–ï¼ˆ99%çš„æƒ…å†µï¼‰
    â””â”€ æ˜¯ â†’ å’¨è¯¢LLM â†’ åº”ç”¨å»ºè®®ï¼ˆ1%çš„æƒ…å†µï¼‰
```

---

## ä¸‰ã€ç›‘ç£è€… - "æ—¥å¸¸ç®¡å®¶"

### æ ¸å¿ƒèŒè´£ï¼ˆæœ€ç¹å¿™ï¼‰

ç›‘ç£è€…æ˜¯**çœŸæ­£çš„æ—¥å¸¸è¿è¥è€…**ï¼š

#### 1. å®æ—¶ç›‘æ§ï¼ˆæ¯å°æ—¶/æ¯å¤©ï¼‰
```python
class Supervisor:
    def daily_routine(self):
        """
        æ—¥å¸¸ç›‘ç£æµç¨‹ï¼ˆä¸éœ€è¦LLMï¼‰
        """
        # 1. ç›‘æ§æ‰€æœ‰Agent
        for agent in agents:
            # è®¡ç®—å¥åº·æŒ‡æ ‡
            report = self.evaluate_agent(agent)
            
            # è¯„ä¼°å¥–ç« 
            medals = self.medal_system.evaluate_and_award(agent)
            
            # æ£€æŸ¥é¢„è­¦
            if report.health_status == 'dying':
                self._issue_warning(agent)
        
        # 2. ç¾¤ä½“ç»Ÿè®¡
        stats = self.monitor_population(agents)
        
        # 3. é£é™©æ£€æµ‹
        alerts = self.detect_system_risks(stats)
        
        # 4. ä¸ŠæŠ¥ç»™ä¸»è„‘
        return {
            'statistics': stats,
            'alerts': alerts,
            'recommendations': self._generate_recommendations()
        }
    
    def _generate_recommendations(self):
        """
        åŸºäºè§„åˆ™ç”Ÿæˆå»ºè®®ï¼ˆä¸éœ€è¦LLMï¼‰
        """
        recommendations = []
        
        if self.population_stats['diversity'] < 0.3:
            recommendations.append("å¢åŠ Agentå¤šæ ·æ€§")
        
        if self.population_stats['health_counts']['dying'] > 5:
            recommendations.append("è€ƒè™‘é™ä½ç¯å¢ƒå‹åŠ›")
        
        return recommendations
```

#### 2. å¥–ç« ç®¡ç†ï¼ˆè‡ªåŠ¨åŒ–ï¼‰
```python
# æ¯æ¬¡è¯„ä¼°Agentæ—¶è‡ªåŠ¨æ£€æŸ¥å¥–ç« 
def evaluate_agent(self, agent):
    # 1. å¥åº·è¯„ä¼°
    report = self._calculate_health_report(agent)
    
    # 2. è‡ªåŠ¨å¥–ç« è¯„ä¼°ï¼ˆä¸éœ€è¦LLMï¼‰
    newly_awarded = self.medal_system.evaluate_and_award(agent.data)
    
    # 3. åº”ç”¨å¥–ç« å½±å“ï¼ˆè‡ªåŠ¨ï¼‰
    if newly_awarded:
        self._apply_medal_effects(agent, newly_awarded)
    
    return report
```

#### 3. åŸºå› åº“ç®¡ç†ï¼ˆè§„åˆ™åŒ–ï¼‰
```python
def should_add_to_gene_pool(self, agent):
    """
    åŸºäºå¥–ç« è§„åˆ™åˆ¤æ–­ï¼ˆä¸éœ€è¦LLMï¼‰
    """
    # è§„åˆ™ï¼šå¿…é¡»æœ‰å¥–ç« ä¸”å¾—åˆ†>3.0
    return self.medal_system.is_qualified_for_gene_pool(
        agent.id, 
        agent.fitness
    )
```

### ç›‘ç£è€…å·¥ä½œå‘¨æœŸ

```
æ¯å°æ—¶ï¼š
â”œâ”€ ç›‘æ§æ‰€æœ‰AgentçŠ¶æ€
â”œâ”€ è¯„ä¼°å¹¶é¢å‘å¥–ç« 
â”œâ”€ è®¡ç®—ç¾¤ä½“ç»Ÿè®¡
â”œâ”€ æ£€æµ‹é£é™©
â””â”€ ä¸ŠæŠ¥ä¸»è„‘

æ¯å¤©ï¼š
â”œâ”€ åŸºå› åº“æ¸…ç†
â”œâ”€ ç»Ÿè®¡æŠ¥å‘Š
â””â”€ è¶‹åŠ¿åˆ†æ

ä¸éœ€è¦LLMå‚ä¸ï¼
```

---

## å››ã€Agent - "å®Œå…¨è‡ªä¸»"

### é›¶å¹²é¢„åŸåˆ™

Agentçš„æ‰€æœ‰å†³ç­–å®Œå…¨è‡ªä¸»ï¼Œ**è°éƒ½ä¸èƒ½å¹²é¢„**ï¼š

```python
class AgentV4:
    def make_trading_decision(self, market_data):
        """
        å®Œå…¨è‡ªä¸»å†³ç­–ï¼ˆä¸å—ä»»ä½•å¤–éƒ¨å¹²é¢„ï¼‰
        """
        # 1. æ›´æ–°æƒ…ç»ª
        self.update_emotional_state()
        
        # 2. è‡ªä¸»å†³å®šæ˜¯å¦è‡ªæ€
        if self.should_commit_suicide():
            self.commit_suicide()
            return None
        
        # 3. è‡ªä¸»å†³å®šæ˜¯å¦æ‹¼æ
        if self.should_enter_last_stand():
            self.enter_last_stand()
        
        # 4. è‡ªä¸»ç”Ÿæˆäº¤æ˜“ä¿¡å·
        signal = self._generate_signal(market_data)
        
        # åº”ç”¨å¥–ç« å¸¦æ¥çš„ä¿¡å¿ƒåŠ æˆï¼ˆè‡ªåŠ¨ï¼‰
        signal = self._apply_medal_confidence_boost(signal)
        
        return signal
```

**å¤–éƒ¨åªèƒ½**ï¼š
- âœ… æä¾›å¸‚åœºæ•°æ®
- âœ… è§‚å¯ŸAgentè¡Œä¸º
- âœ… é¢å‘å¥–ç« ï¼ˆè¢«åŠ¨ï¼‰
- âœ… è®°å½•è¿›åŸºå› åº“

**å¤–éƒ¨ä¸èƒ½**ï¼š
- âŒ å¼ºåˆ¶Agentäº¤æ˜“
- âŒ å¼ºåˆ¶Agentå¹³ä»“
- âŒ ä¿®æ”¹Agentå‚æ•°
- âŒ é˜»æ­¢Agentè‡ªæ€

---

## äº”ã€ä¼˜åŒ–åçš„ç³»ç»Ÿè¿è¡Œæµç¨‹

### æ—¥å¸¸è¿è¡Œï¼ˆ99%çš„æ—¶é—´ï¼‰

```
ã€æ¯å°æ—¶ã€‘
ç›‘ç£è€…ï¼š
  â”œâ”€ ç›‘æ§Agentï¼ˆè‡ªåŠ¨ï¼‰
  â”œâ”€ é¢å‘å¥–ç« ï¼ˆè§„åˆ™åŒ–ï¼‰
  â”œâ”€ è®¡ç®—æŒ‡æ•°ï¼ˆç®—æ³•ï¼‰
  â””â”€ ä¸ŠæŠ¥ç»Ÿè®¡ï¼ˆæ•°æ®ï¼‰

ä¸»è„‘ï¼š
  â”œâ”€ æ¥æ”¶ç›‘ç£è€…æŠ¥å‘Š
  â”œâ”€ åŸºäºè§„åˆ™è°ƒæ•´å‚æ•°ï¼ˆè‡ªåŠ¨ï¼‰
  â”œâ”€ æ›´æ–°ç¯å¢ƒå‹åŠ›ï¼ˆç®—æ³•ï¼‰
  â””â”€ ä¸è°ƒç”¨LLM âœ“

Agentï¼š
  â”œâ”€ è‡ªä¸»åˆ†æå¸‚åœº
  â”œâ”€ è‡ªä¸»äº¤æ˜“å†³ç­–
  â”œâ”€ è‡ªä¸»é£é™©ç®¡ç†
  â””â”€ å®Œå…¨è‡ªä¸» âœ“

ã€ä¸éœ€è¦LLMï¼ç³»ç»Ÿè‡ªä¸»è¿è½¬ã€‘
```

### å®šæœŸå›é¡¾ï¼ˆæ¯å‘¨ä¸€æ¬¡ï¼‰

```
ã€æ¯å‘¨æ—¥ã€‘
ä¸»è„‘ï¼š
  â”œâ”€ æ”¶é›†ä¸€å‘¨æ•°æ®
  â”œâ”€ å’¨è¯¢LLMæˆ˜ç•¥å›é¡¾
  â”œâ”€ è·å¾—è°ƒæ•´å»ºè®®
  â””â”€ æ›´æ–°è§„åˆ™ï¼ˆå¦‚éœ€è¦ï¼‰

ã€ä»…æ­¤æ—¶è°ƒç”¨LLMã€‘
```

### é‡å¤§äº‹ä»¶ï¼ˆæå°‘æ•°æƒ…å†µï¼‰

```
ã€æç«¯æƒ…å†µã€‘
ç›‘ç£è€…æ£€æµ‹åˆ°ï¼š
  â”œâ”€ ç³»ç»Ÿå´©æºƒ
  â”œâ”€ è¿ç»­æ¶…æ§ƒ
  â”œâ”€ åŸºå› åº“æ¯ç«­
  â””â”€ æç«¯å›æ’¤

ä¸»è„‘ï¼š
  â”œâ”€ ç«‹å³å’¨è¯¢LLM
  â”œâ”€ è·å–åº”æ€¥æ–¹æ¡ˆ
  â””â”€ æ‰§è¡Œç‰¹æ®Šæ“ä½œ

ã€ç´§æ€¥å’¨è¯¢LLMã€‘
```

---

## å…­ã€LLMæˆæœ¬å¯¹æ¯”

### åŸè®¾è®¡ï¼ˆæ¯å°æ—¶è°ƒç”¨ï¼‰
```
æ¯å°æ—¶1æ¬¡ Ã— 24å°æ—¶ Ã— 30å¤© = 720æ¬¡/æœˆ
æˆæœ¬: 720 Ã— $0.02 = $14.4/æœˆ
```

### ä¼˜åŒ–åï¼ˆæ¯å‘¨è°ƒç”¨ï¼‰
```
æ¯å‘¨1æ¬¡ Ã— 4å‘¨ = 4æ¬¡/æœˆ
ç´§æ€¥æƒ…å†µ: ~2æ¬¡/æœˆ
æ€»è®¡: ~6æ¬¡/æœˆ
æˆæœ¬: 6 Ã— $0.02 = $0.12/æœˆ

èŠ‚çœ: 99%+ ğŸ’°
```

---

## ä¸ƒã€å»ºè®®çš„å®ç°æ–¹å¼

### ä¿®æ”¹ä¸»è„‘ç±»

```python
class Mastermind:
    def __init__(self, initial_capital, use_llm=True):
        self.initial_capital = initial_capital
        
        # LLMå…ˆçŸ¥ï¼ˆå¯é€‰ï¼‰
        self.llm_oracle = LLMOracle() if use_llm else None
        
        # åˆ›ä¸–æ—¶è®¾å®šè§„åˆ™
        if self.llm_oracle:
            self.rules = self.llm_oracle.create_genesis_rules()
        else:
            self.rules = self._default_rules()
        
        # LLMå’¨è¯¢é—´éš”ï¼ˆé»˜è®¤æ¯å‘¨ï¼‰
        self.llm_consultation_interval = timedelta(weeks=1)
        self.last_llm_consultation = datetime.now()
        
    def make_decision(self, market_data, agent_stats, system_metrics):
        """
        å†³ç­–æµç¨‹ï¼ˆä¸»è¦é è§„åˆ™ï¼‰
        """
        # 1. åŸºäºè§„åˆ™è‡ªåŠ¨å†³ç­–ï¼ˆä¸è°ƒç”¨LLMï¼‰
        decision = self._rule_based_decision(
            market_data, agent_stats, system_metrics
        )
        
        # 2. æ£€æŸ¥æ˜¯å¦éœ€è¦å’¨è¯¢LLM
        if self._should_consult_llm(system_metrics):
            logger.info("ğŸ¤– å’¨è¯¢LLMå…ˆçŸ¥...")
            llm_advice = self.llm_oracle.strategic_review(
                market_data, agent_stats, system_metrics
            )
            decision = self._apply_llm_advice(decision, llm_advice)
            self.last_llm_consultation = datetime.now()
        
        return decision
    
    def _should_consult_llm(self, metrics):
        """
        åˆ¤æ–­æ˜¯å¦éœ€è¦å’¨è¯¢LLM
        
        ä»…ä»¥ä¸‹æƒ…å†µå’¨è¯¢ï¼š
        1. å®šæœŸå›é¡¾ï¼ˆæ¯å‘¨ï¼‰
        2. é‡å¤§äº‹ä»¶
        """
        # å®šæœŸå›é¡¾
        if datetime.now() - self.last_llm_consultation > self.llm_consultation_interval:
            return True
        
        # é‡å¤§äº‹ä»¶
        major_events = [
            metrics.get('system_drawdown', 0) > 0.5,
            metrics.get('agent_count', 100) < 3,
            metrics.get('consecutive_nirvana', 0) > 3,
            metrics.get('gene_pool_size', 100) < 10,
        ]
        
        return any(major_events)
    
    def _rule_based_decision(self, market_data, agent_stats, system_metrics):
        """
        åŸºäºè§„åˆ™çš„è‡ªåŠ¨å†³ç­–ï¼ˆä¸è°ƒç”¨LLMï¼‰
        
        è¿™æ˜¯99%æƒ…å†µä¸‹çš„å†³ç­–æ–¹å¼
        """
        # åº”ç”¨é¢„è®¾è§„åˆ™è‡ªåŠ¨è°ƒæ•´å‚æ•°
        strategy = self.strategy.copy()
        
        # è§„åˆ™1ï¼šæ ¹æ®å¸‚åœºæ³¢åŠ¨è°ƒæ•´
        volatility = market_data.get('volatility', 0)
        if volatility > 0.05:
            strategy.environmental_pressure *= 1.2
            strategy.capital_utilization *= 0.8
        elif volatility < 0.01:
            strategy.environmental_pressure *= 0.9
            strategy.capital_utilization *= 1.1
        
        # è§„åˆ™2ï¼šæ ¹æ®Agentè¡¨ç°è°ƒæ•´
        avg_performance = agent_stats.get('avg_performance', 0)
        if avg_performance < -0.2:
            strategy.selection_pressure *= 1.3
        elif avg_performance > 0.3:
            strategy.selection_pressure *= 0.8
        
        # è§„åˆ™3ï¼šæ ¹æ®å¤šæ ·æ€§è°ƒæ•´
        diversity = agent_stats.get('diversity', 0.5)
        if diversity < 0.3:
            strategy.mutation_rate *= 1.5
        
        # è§„åˆ™4ï¼šæ ¹æ®ç³»ç»Ÿå¥åº·è°ƒæ•´
        if system_metrics.get('health', 'healthy') == 'critical':
            strategy.capital_utilization = 0.5  # ä¿å®ˆ
            strategy.risk_level = 1  # æœ€ä½é£é™©
        
        return {
            'strategy': strategy,
            'source': 'rule_based',  # ä¸æ˜¯LLM
            'llm_consulted': False
        }
```

---

## å…«ã€æ€»ç»“ï¼šå„è§’è‰²åˆ†å·¥

| è§’è‰² | èŒè´£ | é¢‘ç‡ | LLMå‚ä¸ | è‡ªä¸»æ€§ |
|------|------|------|---------|--------|
| ğŸ¤– **LLMå…ˆçŸ¥** | åˆ›ä¸–è§„åˆ™ã€æˆ˜ç•¥å›é¡¾ | æ¯å‘¨ | âœ… æœ¬ä½“ | - |
| ğŸ§  **ä¸»è„‘** | è§„åˆ™æ‰§è¡Œã€å‚æ•°è°ƒæ•´ | æ¯å°æ—¶ | âŒ ä¸å‚ä¸ | é«˜ |
| ğŸ‘ï¸ **ç›‘ç£è€…** | æ—¥å¸¸ç›‘ç£ã€å¥–ç« ç®¡ç† | æ¯å°æ—¶ | âŒ ä¸å‚ä¸ | é«˜ |
| ğŸ¤– **Agent** | è‡ªä¸»äº¤æ˜“ã€ç”Ÿæ­»å†³ç­– | æ¯åˆ†é’Ÿ | âŒ ä¸å‚ä¸ | å®Œå…¨ |

### å…³é”®åŸåˆ™

1. **LLMæ˜¯é€ ç‰©ä¸»ï¼Œä¸æ˜¯ä¿å§†**
   - åˆ›ä¸–æ—¶è®¾å®šè§„åˆ™
   - å®šæœŸï¼ˆæ¯å‘¨ï¼‰æˆ˜ç•¥å›é¡¾
   - é‡å¤§äº‹ä»¶ç´§æ€¥å’¨è¯¢
   - **ä¸å‚ä¸æ—¥å¸¸è¿è¥**

2. **ä¸»è„‘æ˜¯æ‰§è¡Œè€…ï¼Œä¸æ˜¯æçº¿æœ¨å¶**
   - åŸºäºè§„åˆ™è‡ªåŠ¨å†³ç­–
   - ç›‘æ§ç³»ç»ŸæŒ‡æ ‡
   - è¯†åˆ«éœ€è¦LLMçš„æ—¶æœº
   - **99%é è§„åˆ™è¿è¡Œ**

3. **ç›‘ç£è€…æ˜¯ç®¡å®¶ï¼ŒçœŸæ­£çš„è¿è¥è€…**
   - æ—¥å¸¸ç›‘æ§æ‰€æœ‰Agent
   - è‡ªåŠ¨è¯„ä¼°å’Œé¢å¥–
   - åŸºå› åº“ç®¡ç†
   - **æ‰¿æ‹…æ—¥å¸¸å·¥ä½œ**

4. **Agentå®Œå…¨è‡ªä¸»ï¼Œè°éƒ½ä¸å¹²é¢„**
   - è‡ªä¸»äº¤æ˜“å†³ç­–
   - è‡ªä¸»ç”Ÿæ­»é€‰æ‹©
   - æ¥å—å¥–ç« æ¿€åŠ±
   - **å®Œå…¨è‡ªç”±**

---

## ä¹ã€å®æ–½å»ºè®®

### ä»£ç ä¿®æ”¹ä¼˜å…ˆçº§

1. âœ… **ä¿æŒç°æœ‰æ¶æ„** - ä¸éœ€è¦å¤§æ”¹
2. âœ… **ä¿®æ”¹ä¸»è„‘å†³ç­–é€»è¾‘** - æ·»åŠ è§„åˆ™å¼•æ“
3. âœ… **å‡å°‘LLMè°ƒç”¨** - ä»…ç‰¹å®šæ—¶æœº
4. âœ… **å¢å¼ºç›‘ç£è€…èŒè´£** - æ—¥å¸¸è¿è¥æ ¸å¿ƒ

### é…ç½®å»ºè®®

```python
CONFIG = {
    # LLMå’¨è¯¢è®¾ç½®
    'llm_consultation_interval': 'weekly',  # æ¯å‘¨ä¸€æ¬¡
    'llm_emergency_threshold': {
        'max_drawdown': 0.5,
        'min_agent_count': 3,
        'max_consecutive_nirvana': 3
    },
    
    # ä¸»è„‘è§„åˆ™å¼•æ“
    'rule_based_decision': True,  # é»˜è®¤ä½¿ç”¨è§„åˆ™
    'auto_adjust_parameters': True,  # è‡ªåŠ¨è°ƒæ•´
    
    # ç›‘ç£è€…é¢‘ç‡
    'monitoring_interval': '1h',  # æ¯å°æ—¶ç›‘æ§
    'medal_check_interval': '1h',  # æ¯å°æ—¶æ£€æŸ¥å¥–ç« 
}
```

---

**è¿™æ ·çš„åˆ†å·¥æ›´åˆç†ã€æ›´ç»æµã€æ›´è‡ªä¸»ï¼** ğŸ¯

æœ€åæ›´æ–°ï¼š2025å¹´12æœˆ1æ—¥

