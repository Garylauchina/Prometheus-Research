# Prometheus v3.0 - 参数详解与调优指南

**版本**: 1.0  
**日期**: 2025年11月29日

---

## 1. 参数设计哲学：在混沌中寻找秩序

Prometheus系统的参数分为三类：

1.  **系统级参数**：决定系统的宏观运行方式。
2.  **风控参数**：系统的"安全带"，决定风险承受能力。
3.  **Agent基因参数**：决定每个Agent的微观交易行为，是进化的核心。

> "参数调优的艺术，不在于找到一个完美的组合，而在于理解每个参数背后的行为逻辑，并让它们协同工作。"

---

## 2. 系统级参数 (`config_virtual.py`)

这些参数定义了系统的基本框架和运行节奏。

| 参数 | 默认值 | 含义 | 调优建议 |
|---|---|---|---|
| `initial_capital` | 5000 | 初始总资金 | 根据您的实际情况设置。建议从模拟盘开始。 |
| `initial_agents` | 5 | 初始Agent数量 | **建议5-10个**。太少则多样性不足，太多则计算资源消耗大。 |
| `max_agents` | 10 | 最大Agent数量 | **建议为初始数量的2-3倍**。用于控制种群规模，防止无限繁殖。 |
| `update_interval` | 60 | 系统更新间隔（秒） | **60秒是均衡选择**。短于30秒可能触发API频率限制，长于300秒可能错过机会。 |
| `order_timeout` | 300 | 订单超时时间（秒） | **建议300-600秒**。如果订单在此时限内未成交，将被取消。 |
| `retry_attempts` | 3 | API调用重试次数 | **建议3-5次**。用于应对网络波动或API临时错误。 |

### 2.1 市场配置 (`markets`)

```python
'markets': {
    'spot': {
        'enabled': True,
        'symbol': 'BTC-USDT',
        'allocation': 0.5  # 50%资金分配给现货
    },
    'futures': {
        'enabled': True,
        'symbol': 'BTC-USDT-SWAP',
        'allocation': 0.5, # 50%资金分配给合约
        'max_leverage': 3
    }
}
```

-   **`allocation`**: 资金分配比例。**建议现货和合约各占50%**，以分散风险。
-   **`max_leverage`**: 最大杠杆倍数。**强烈建议新手不要超过3倍**。高杠杆是爆仓的主要原因。

---

## 3. 风控参数 (`risk`)

这些参数是系统的生命线，决定了系统能承受多大的风险。

| 参数 | 默认值 | 含义 | 调优建议 |
|---|---|---|---|
| `max_daily_trades` | 100 | 每日最大交易次数 | **建议100-200次**。防止系统在异常行情下失控刷单。 |
| `max_daily_loss` | 0.10 | 每日最大亏损比例 | **核心风控参数**。当总资金亏损达到10%时，系统将暂停所有交易。**建议0.05-0.15**。 |
| `max_leverage` | 3 | 全局最大杠杆 | 即使合约市场设置了更高杠杆，也会被此参数限制。**是最后的保险丝**。 |
| `max_position_pct` | 0.30 | 单笔订单最大仓位 | 单笔订单使用的资金不能超过总资金的30%。**建议0.2-0.5**。 |
| `stop_loss_pct` | 0.05 | 默认止损比例 | 如果Agent基因中的止损参数异常，将使用此默认值。 |
| `max_order_value` | 500 | 单笔订单最大金额 | 防止下出天价单。**建议设置为`initial_capital`的10%左右**。 |

---

## 4. Agent基因参数 (`live_agent.py`)

这些参数是遗传算法的核心，决定了Agent的多样性和进化方向。每个Agent在诞生时会随机生成一套基因。

| 参数 | 范围 | 含义 | 调优建议 |
|---|---|---|---|
| `long_threshold` | 0.05-0.15 | 做多信号阈值 | **核心策略参数**。当动量指标超过此值时触发做多。值越小越激进。 |
| `short_threshold` | -0.15--0.05 | 做空信号阈值 | 当动量指标低于此值时触发做空。值越大越激进。 |
| `max_position` | 0.5-1.0 | 最大仓位比例 | Agent自身资金的最大使用比例。**建议0.8-1.0**，让Agent充分利用资金。 |
| `stop_loss` | 0.03-0.08 | 止损百分比 | **决定Agent的生存能力**。太小容易被震荡止损，太大则亏损严重。 |
| `take_profit` | 0.05-0.15 | 止盈百分比 | **决定Agent的盈利能力**。太小赚得少，太大则容易回吐利润。 |
| `holding_period` | 300-3600 | 持仓周期（秒） | Agent愿意持仓的最长时间。**建议300-7200秒（5分钟-2小时）**。 |
| `risk_aversion` | 0.5-1.5 | 风险厌恶系数 | **影响Agent的决策偏好**。值越高，Agent越倾向于规避风险。 |

### 4.1 基因变异

当一个优秀的Agent"繁殖"后代时，后代的基因会在父代的基础上发生**轻微变异**（通常在±10%范围内）。

```python
# 基因变异示例
new_gene_value = parent_gene_value * (1 + random.uniform(-0.1, 0.1))
```

这种设计使得系统能够在**保持优势策略的同时，不断探索新的可能性**。

---

## 5. 市场状态检测参数 (`market_regime.py`)

这些参数决定了如何划分市场状态。

| 状态 | 定义 | 含义 |
|---|---|---|
| **Strong Bull** | 30日涨幅 > 20% | 强牛市，适合追涨 |
| **Weak Bull** | 30日涨幅 5-20% | 弱牛市，适合逢低做多 |
| **Sideways** | 30日涨跌幅 ±5% | 震荡市，适合高抛低吸或观望 |
| **Weak Bear** | 30日跌幅 5-20% | 弱熊市，适合逢高做空 |
| **Strong Bear** | 30日跌幅 > 20% | 强熊市，适合追空 |

**为什么是30日？**

- **太短（如7日）**: 容易被短期噪音干扰。
- **太长（如90日）**: 对市场变化反应迟钝。

**30日**是一个比较适中的时间窗口，能够反映中期趋势。

---

## 6. 调优指南

### 6.1 新手入门

- **不要修改任何参数**，直接使用默认配置在模拟盘运行。
- 观察至少一周，理解系统在不同市场下的行为。

### 6.2 进阶调优

1.  **调整风险偏好**
    - **保守型**: 降低`max_daily_loss` (如0.05)，降低`max_leverage` (如2)，提高`risk_aversion`范围。
    - **激进型**: 提高`max_daily_loss` (如0.15)，提高`max_leverage` (如5)，降低`risk_aversion`范围。

2.  **调整交易频率**
    - **提高频率**: 降低`long_threshold`和`short_threshold`的范围，缩短`holding_period`范围。
    - **降低频率**: 提高`long_threshold`和`short_threshold`的范围，延长`holding_period`范围。

3.  **调整策略类型**
    - **趋势策略**: 延长`holding_period`，放大`take_profit`范围。
    - **剥头皮策略**: 缩短`holding_period`，缩小`take_profit`和`stop_loss`范围。

### 6.3 调优流程

1.  **只修改一个参数**：每次只调整一个参数，便于观察效果。
2.  **进行A/B测试**：运行两个不同配置的系统，对比表现。
3.  **记录调优日志**：详细记录每次修改的原因、时间和效果。
4.  **回测验证**：在修改实盘参数前，先用回测验证新参数的有效性。

> **警告**: 参数调优是一个复杂且耗时的过程，没有捷径。错误的参数组合可能导致严重亏损。请务必在模拟盘充分测试。

---

*本文档由Manus AI生成*  
*最后更新: 2025-11-29*
