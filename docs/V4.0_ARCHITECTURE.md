# Prometheus v4.0 核心架构设计

## 🎯 核心理念

**完全自主的进化交易生态系统**

v4.0 将构建一个真正自主的 AI 交易生态，其中 Agent 拥有完整的生命周期自主权，系统通过三层架构实现宏观调控与微观自由的平衡。

---

## 🏗️ 三大角色体系

### 1. 主脑 (Mastermind)

**定位**：系统的最高决策层，战略规划者

**核心职责**：
- 📊 **宏观市场分析**
  - 分析整体市场趋势（牛市/熊市/震荡）
  - 识别系统性风险和机会
  - 制定全局交易策略方向

- 💰 **资源分配策略**
  - 决定总体资金池规模
  - 设定风险等级和仓位上限
  - 调整系统级参数（如资金利用率）

- 🧬 **进化方向引导**
  - 设定适应度评估标准
  - 调整环境压力参数
  - 引导 Agent 群体朝有利方向进化

- 🎯 **生态平衡控制**
  - 控制 Agent 群体规模上下限
  - 维持策略多样性
  - 防止系统性崩溃

**特性**：
- ⏱️ 决策周期：每日/每周级别
- 🔍 视野：全局、长期
- ⚖️ 权力：制定规则，但**不直接干预单个 Agent**

---

### 2. 监督者 (Supervisor)

**定位**：系统的观察者和评估者，生态管理员

**核心职责**：
- 👁️ **监控 Agent 状态**
  - 实时监控所有 Agent 的健康状况
  - 记录 Agent 行为数据
  - 识别异常行为模式

- 📈 **绩效评估**
  - 计算 Agent 适应度分数
  - 评估 Agent 对环境的适应能力
  - 生成 Agent 生命体征报告

- 🌍 **环境压力施加**
  - 根据 Agent 表现调整环境压力
  - 触发自然选择机制
  - 维护生态竞争平衡

- 📊 **数据收集与分析**
  - 收集交易数据、基因数据
  - 分析进化趋势
  - 为主脑提供决策依据

- 🔔 **预警机制**
  - 监测系统级风险
  - 发现潜在的系统故障
  - 向主脑报告重要事件

**特性**：
- ⏱️ 决策周期：每小时/每日级别
- 🔍 视野：群体行为、统计规律
- ⚖️ 权力：观察、评估、记录，**不直接干预 Agent 决策**

---

### 3. Agent (智能体)

**定位**：完全自主的交易执行者，系统的基本单元

**生命周期**：
```
出生 → 成长 → 成熟 → 衰老 → 死亡
  ↓      ↓      ↓      ↓      ↓
获得   学习   巅峰   衰退   终结
资金   适应   表现   挣扎   （自然死亡/自杀/被淘汰）
```

#### 核心职责：
- 💹 **自主交易决策**
  - 分析市场信号
  - 决定开仓/平仓/持仓
  - 自主管理仓位和风险

- 🧬 **自我进化**
  - 根据市场反馈调整策略
  - 微调基因参数
  - 学习和适应环境

- 💰 **资金管理**
  - 管理自己的资金账户
  - 决定每笔交易的仓位
  - 控制风险敞口

- 🎯 **生存策略**
  - 评估自身生存状态
  - 在困境中寻找出路
  - 决定是否启动特殊行为

#### 完全自主原则：
✅ **Agent 拥有的自主权**：
- 所有交易决策
- 风险偏好设定
- 策略调整
- 生存与死亡选择

❌ **外部不能干预的**：
- 强制修改 Agent 参数
- 强制关闭 Agent 交易
- 强制改变 Agent 策略
- 干预 Agent 生死决策

---

## 🆕 v4.0 新特性：Agent 情绪与极端行为

### 1. 绝望自杀 (Despair Suicide)

**触发条件**：
当 Agent 的多个生存指标同时恶化到临界值时，Agent 可能选择自我终结。

**评估指标**：
```python
绝望指数 = f(
    连续亏损次数,        # 如：连续 10 次交易亏损
    累计亏损幅度,        # 如：资金回撤 > 50%
    市场适应度得分,      # 如：适应度 < 临界值
    生存时长,            # 如：存活时间 vs 同期 Agent
    环境压力等级         # 如：高压力环境下更容易绝望
)

if 绝望指数 > 自杀阈值:
    Agent.commit_suicide()
```

**自杀行为**：
1. Agent 主动平掉所有持仓
2. 将剩余资金归还资金池
3. 记录死亡原因和基因信息
4. 自我销毁，释放系统资源

**意义**：
- 🔄 加速劣质基因淘汰
- 💰 避免持续消耗资源
- 🧬 为新 Agent 腾出空间
- 📊 提供负向学习样本

---

### 2. 拼死一搏 (Last Stand)

**触发条件**：
当 Agent 处于濒死边缘但尚未绝望时，可能选择高风险高回报策略。

**评估指标**：
```python
濒危指数 = f(
    当前资金/初始资金,    # 如：剩余资金 < 30%
    近期盈亏趋势,         # 如：持续下滑但有反弹迹象
    市场机会评分,         # 如：识别到高胜率机会
    生存意志,             # Agent 的"求生欲"参数
    性格特质              # 激进型 Agent 更容易触发
)

if 濒危指数 > 拼搏阈值 and 机会评分 > 最低要求:
    Agent.last_stand_mode()
```

**拼搏行为**：
1. **大幅提高仓位**
   - 正常仓位：10-30%
   - 拼搏仓位：50-80%（孤注一掷）

2. **采用激进策略**
   - 更高的杠杆
   - 更短的止损
   - 更激进的入场

3. **缩短决策周期**
   - 更频繁的监控
   - 更快的反应速度

**可能结果**：
- ✅ **成功**：资金大幅回升，延续生命
- ❌ **失败**：快速亏损，加速死亡

**意义**：
- 🎲 给予濒死 Agent 翻盘机会
- 🧬 筛选出真正优秀的基因
- 📈 增加系统动态性和戏剧性
- 💡 模拟真实交易心理

---

## 🔄 三者协作关系

```
主脑 (Mastermind)
    │
    ├─ 制定全局策略
    ├─ 设定环境参数
    └─ 定义评估标准
          ↓
监督者 (Supervisor)
    │
    ├─ 观察 Agent 群体
    ├─ 计算适应度分数
    ├─ 施加环境压力
    └─ 上报统计数据
          ↓
Agent 群体 (Agents)
    │
    ├─ Agent A → 自主交易、自我进化
    ├─ Agent B → 自主交易、自我进化
    ├─ Agent C → 【绝望自杀】→ 💀
    ├─ Agent D → 【拼死一搏】→ 💰 或 💀
    └─ Agent E → 自主交易、自我进化
```

**关键原则**：
1. **单向信息流**：主脑 → 监督者 → Agent（设定规则）
2. **反馈循环**：Agent 表现 → 监督者评估 → 主脑调整规则
3. **自主决策**：Agent 在规则范围内完全自主
4. **自然选择**：通过环境压力而非强制干预实现进化

---

## 🎯 与 v3.x 的对比

| 特性 | v3.x | v4.0 |
|------|------|------|
| 架构层次 | 扁平化（Agent + Manager） | 三层（主脑/监督者/Agent） |
| Agent 自主性 | 部分自主 | 完全自主 |
| 干预方式 | 主动干预 | 环境引导 |
| 生死控制 | 外部决定 | Agent 自主选择 |
| 情绪模拟 | 无 | 绝望自杀、拼死一搏 |
| 决策层级 | 单一 | 三级（战略/战术/执行） |
| 进化机制 | 简单遗传 | 完整生态模拟 |

---

## 📋 实现优先级

### Phase 1: 基础架构 (2周)
- [ ] 设计并实现 Mastermind 类
- [ ] 设计并实现 Supervisor 类
- [ ] 重构 Agent 类以支持完全自主

### Phase 2: 生命周期 (2周)
- [ ] 实现 Agent 完整生命周期
- [ ] 实现绝望指数计算
- [ ] 实现濒危指数计算
- [ ] 实现自杀机制
- [ ] 实现拼搏机制

### Phase 3: 生态系统 (2周)
- [ ] 实现三者协作机制
- [ ] 实现环境压力系统
- [ ] 实现自然选择机制
- [ ] 实现种群动态平衡

### Phase 4: 测试优化 (2周)
- [ ] 回测验证
- [ ] 参数调优
- [ ] 性能优化
- [ ] 文档完善

---

## 💭 待讨论的问题

1. **主脑的决策频率**：每日还是每周？如何平衡响应速度和稳定性？

2. **绝望自杀的阈值**：如何设定才能既淘汰劣质 Agent，又不过于激进？

3. **拼死一搏的风控**：如何防止单个 Agent 的极端行为影响整体系统？

4. **Agent 数量控制**：最小/最大 Agent 数量？如何动态调整？

5. **策略多样性**：如何确保 Agent 群体保持足够的策略多样性？

6. **资金分配机制**：新生 Agent 如何获得初始资金？表现好的 Agent 如何获得更多资金？

7. **基因遗传方式**：死亡 Agent 的基因是否可以被继承？如何继承？

---

## 🎨 系统愿景

构建一个**真正自主进化的交易生态系统**，其中：
- 🧠 主脑是智慧的造物主
- 👁️ 监督者是公正的观察者
- 🤖 Agent 是自由的生命体

让 AI 在规则约束下自由进化，通过自然选择找到最优策略，而不是通过人为干预强行优化。

---

最后更新：2025年12月1日

